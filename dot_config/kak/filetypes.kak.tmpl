# -----------------------------------------------------------------------------
# Filetypes configuration.
# -----------------------------------------------------------------------------

# Config for Go filetypes
hook global WinSetOption filetype=go %{
    # Use golangci-lint for linting
    set window formatcmd 'goimports'
    set window lintcmd 'golangci-lint run'

    # LSP-related config
    lsp-enable-window
	lsp-inlay-diagnostics-enable buffer
    set window lsp_auto_highlight_references true

    # Run goimports for formatting
    hook buffer BufWritePre .* %{
		format-buffer
        lint
    }

    # Override some plugin colours
    set-face global Reference yellow+b
    set-face global Covered green+b
    set-face global NotCovered red+b
}

# Shell scripts
hook global WinSetOption filetype=sh %{
    # Use golangci-lint for linting
    set window lintcmd 'shellcheck -fgcc -Cnever'
    set window formatcmd 'shfmt -ci -i 2'

    # Format and lint on save
    hook buffer BufWritePre .* %{
        format
        lint
    }
}

{{if eq .work false}}
# WebAssembly Text files (just highlight as Lisp)
hook global BufCreate .*\.wat %{
   set buffer filetype lisp 
}
{{else}}
# Set bats (Bash unit-test) files to `sh` filetype
hook global BufCreate .*\.bats %{
    set buffer filetype sh
}

# Set mdx files to markdown filetype
hook global BufCreate .*\.mdx %{
	set buffer filetype markdown
}
{{end -}}

